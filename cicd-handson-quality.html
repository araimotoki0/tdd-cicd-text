<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>応用編：コード品質チェック - CI/CD実践ハンズオン</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50">
    <!-- ナビゲーションバー -->
    <nav class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg fixed w-full top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="text-2xl font-bold">CI/CD実践講座</div>
                <div class="hidden md:flex space-x-4 text-sm items-center">
                    <a href="cicd-index.html" class="hover:text-blue-200">理論編</a>
                    <span class="text-blue-200">|</span>
                    <a href="cicd-handson-basic.html" class="hover:text-blue-200">基礎：自動テスト</a>
                    <a href="cicd-handson-quality.html" class="hover:text-blue-200 font-semibold">応用：品質チェック</a>
                    <a href="cicd-handson-deploy.html" class="hover:text-blue-200">実践：自動デプロイ</a>
                    <span class="text-blue-200">|</span>
                    <a href="index.html" class="hover:text-blue-200">TDD</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="pt-20">
        <!-- ヒーローセクション -->
        <section class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white py-20">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-5xl font-bold mb-6">応用編：コード品質チェック</h2>
                <p class="text-2xl mb-4">静的解析ツールでコード品質を自動的に保証しましょう</p>
            </div>
        </section>

        <!-- コンテンツ -->
        <div class="container mx-auto px-4 py-12 max-w-4xl">

            <!-- セクション1: コード品質チェックとは -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">📋 コード品質チェックとは</h2>

                <div class="prose max-w-none">
                    <p class="text-lg mb-4">
                        コード品質チェックは、実際にコードを実行せずにソースコードを解析し、潜在的な問題を検出する手法です。
                    </p>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6">
                        <h3 class="font-bold text-lg mb-2">🎯 品質チェックの目的</h3>
                        <ul class="list-disc ml-6 space-y-2">
                            <li><strong>バグの早期発見</strong>：型エラーや未定義変数などを実行前に検出</li>
                            <li><strong>コードの統一性</strong>：チーム全体で一貫したコーディングスタイルを維持</li>
                            <li><strong>保守性の向上</strong>：読みやすく理解しやすいコードを保証</li>
                            <li><strong>レビュー効率化</strong>：機械的にチェックできる部分を自動化</li>
                        </ul>
                    </div>

                    <h3 class="text-xl font-bold mb-3 mt-6">主な品質チェックツール</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-bold text-blue-600 mb-2">PHPStan</h4>
                            <p class="text-sm">静的解析ツール。型エラーや潜在的なバグを検出します。</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-bold text-blue-600 mb-2">PHP CS Fixer</h4>
                            <p class="text-sm">コーディングスタイルを自動修正・チェックするツール。</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- セクション2: PHPStanのセットアップ -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">🔍 Step 1: PHPStanのセットアップ</h2>

                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-3">1. PHPStanのインストール</h3>
                    <p class="mb-4">Composerを使ってPHPStanとLaravel専用の拡張機能をインストールします。</p>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-4">
                        <p class="text-sm text-gray-800">
                            <strong>💡 Docker環境の場合:</strong> まずコンテナに入ってから実行してください。
                        </p>
                    </div>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># Docker環境の場合、まずコンテナに入る
docker compose exec app bash

# PHPStanとLaravel拡張をインストール
composer require --dev phpstan/phpstan
composer require --dev larastan/larastan</code></pre>
                    </div>

                    <div class="bg-green-50 border-l-4 border-green-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">✅ Larastanとは</h4>
                        <p class="text-sm">LarastanはLaravel専用のPHPStan拡張です。Eloquentモデルのメソッドやプロパティを正しく認識し、誤検知を減らします。</p>
                    </div>

                    <h3 class="text-xl font-bold mb-3 mt-6">2. 設定ファイルの作成</h3>
                    <p class="mb-4">Laravelプロジェクトのルート（<code>composer.json</code>がある場所）に <code>phpstan.neon</code> を作成します。</p>

                    <div class="bg-yellow-50 border-l-4 border-yellow-600 p-4 mb-4">
                        <p class="text-sm text-gray-800">
                            <strong>⚠️ 注意:</strong> プロジェクト構造によって配置場所が異なります。<br>
                            • Laravelプロジェクトがリポジトリルートにある場合 → ルートに作成<br>
                            • Laravelプロジェクトが<code>src</code>ディレクトリ内にある場合 → <code>src/phpstan.neon</code>として作成
                        </p>
                    </div>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code>includes:
    - ./vendor/larastan/larastan/extension.neon

parameters:
    level: 1
    paths:
        - app
        - tests
    excludePaths:
        - app/Console/Kernel.php (?)</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">💡 設定の解説</h4>
                        <ul class="list-disc ml-6 text-sm space-y-1">
                            <li><strong>includes:</strong> Larastanの拡張機能を読み込み（Laravel専用のルール）</li>
                            <li><strong>level: 1:</strong> 入門向けの緩やかなチェックレベル（レベル0-9まであり、数字が大きいほど厳格。慣れてきたら徐々に上げていきましょう）</li>
                            <li><strong>excludePaths:</strong> <code>(?)</code>を付けることで、ファイルが存在しない場合もエラーにならない（Laravel 11以降では<code>Kernel.php</code>が廃止されているため）</li>
                        </ul>
                    </div>

                    <h3 class="text-xl font-bold mb-3 mt-6">3. Laravel IDE Helperのインストールと生成</h3>
                    <p class="mb-4">LarastanがEloquentモデルを正しく認識するために、IDE Helperパッケージをインストールし、ヘルパーファイルを生成します。</p>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># Docker環境の場合はコンテナ内で実行

# IDE Helperパッケージをインストール
composer require --dev barryvdh/laravel-ide-helper

# ヘルパーファイルを生成
php artisan ide-helper:generate
php artisan ide-helper:models --nowrite</code></pre>
                    </div>

                    <p class="text-sm text-gray-600 mb-6">これにより、<code>_ide_helper.php</code>と<code>_ide_helper_models.php</code>が生成されます。</p>

                    <h3 class="text-xl font-bold mb-3 mt-6">4. ローカルで実行</h3>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-4">
                        <p class="text-sm text-gray-800">
                            <strong>💡 実行場所:</strong> <code>phpstan.neon</code>があるディレクトリ（Laravelプロジェクトのルート）で実行してください。
                        </p>
                    </div>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># Laravelプロジェクトのルートディレクトリで実行
# (srcディレクトリ構成の場合は cd src してから実行)
./vendor/bin/phpstan analyse --memory-limit=512M</code></pre>
                    </div>

                    <p class="text-sm text-gray-600">エラーがなければ「No errors」と表示されます。型エラーなどが検出された場合は、修正してから再実行します。</p>
                </div>
            </section>

            <!-- セクション3: PHP CS Fixerのセットアップ -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">✨ Step 2: PHP CS Fixerのセットアップ</h2>

                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mb-3">1. PHP CS Fixerのインストール</h3>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-4">
                        <p class="text-sm text-gray-800">
                            <strong>💡 Docker環境の場合:</strong> コンテナ内で実行してください。
                        </p>
                    </div>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># Docker環境の場合
docker compose exec app bash

# PHP CS Fixerをインストール
composer require --dev friendsofphp/php-cs-fixer</code></pre>
                    </div>

                    <h3 class="text-xl font-bold mb-3 mt-6">2. 設定ファイルの作成</h3>
                    <p class="mb-4">Laravelプロジェクトのルート（<code>composer.json</code>がある場所）に <code>.php-cs-fixer.php</code> を作成します。</p>

                    <div class="bg-yellow-50 border-l-4 border-yellow-600 p-4 mb-4">
                        <p class="text-sm text-gray-800">
                            <strong>⚠️ 注意:</strong> <code>src</code>ディレクトリ構成の場合は、<code>src/.php-cs-fixer.php</code>として作成してください。
                        </p>
                    </div>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code>&lt;?php

$finder = PhpCsFixer\Finder::create()
    -&gt;in([
        __DIR__ . '/app',
        __DIR__ . '/tests',
    ])
    -&gt;name('*.php')
    -&gt;notName('*.blade.php')
    -&gt;ignoreDotFiles(true)
    -&gt;ignoreVCS(true);

return (new PhpCsFixer\Config())
    -&gt;setRules([
        '@PSR12' =&gt; true,
        'array_syntax' =&gt; ['syntax' =&gt; 'short'],
        'ordered_imports' =&gt; ['sort_algorithm' =&gt; 'alpha'],
        'no_unused_imports' =&gt; true,
        'not_operator_with_successor_space' =&gt; true,
        'trailing_comma_in_multiline' =&gt; ['elements' =&gt; ['arrays']],
        'phpdoc_scalar' =&gt; true,
        'unary_operator_spaces' =&gt; true,
        'binary_operator_spaces' =&gt; true,
        'blank_line_before_statement' =&gt; [
            'statements' =&gt; ['break', 'continue', 'declare', 'return', 'throw', 'try'],
        ],
        'phpdoc_single_line_var_spacing' =&gt; true,
        'phpdoc_var_without_name' =&gt; true,
    ])
    -&gt;setFinder($finder);</code></pre>
                    </div>

                    <h3 class="text-xl font-bold mb-3 mt-6">3. ローカルで実行</h3>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-4">
                        <p class="text-sm text-gray-800">
                            <strong>💡 実行場所:</strong> <code>.php-cs-fixer.php</code>があるディレクトリ（Laravelプロジェクトのルート）で実行してください。
                        </p>
                    </div>

                    <h4 class="font-bold mb-2">チェックのみ（修正しない）</h4>
                    <div class="code-block-wrapper relative mb-4">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># Laravelプロジェクトのルートで実行
# (srcディレクトリ構成の場合は cd src してから実行)
./vendor/bin/php-cs-fixer fix --dry-run --diff</code></pre>
                    </div>

                    <h4 class="font-bold mb-2 mt-4">自動修正</h4>
                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># コードスタイルを自動修正
./vendor/bin/php-cs-fixer fix

# 修正後、再度チェックして確認
./vendor/bin/php-cs-fixer fix --dry-run --diff</code></pre>
                    </div>

                    <div class="bg-green-50 border-l-4 border-green-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">✅ 推奨フロー</h4>
                        <ol class="list-decimal ml-6 text-sm space-y-1">
                            <li>コードを書く</li>
                            <li><code>./vendor/bin/php-cs-fixer fix</code> でスタイルを自動修正</li>
                            <li><code>./vendor/bin/phpstan analyse --memory-limit=512M</code> で型チェック</li>
                            <li>問題なければコミット&プッシュ → CI/CDが通る</li>
                        </ol>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">💡 PSR-12とは</h4>
                        <p class="text-sm">PHP標準のコーディングスタイル規約です。インデント、命名規則、改行位置などが定義されています。</p>
                    </div>
                </div>
            </section>

            <!-- セクション4: GitHub Actionsへの統合 -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">🔗 Step 3: GitHub Actionsへの統合</h2>

                <div class="prose max-w-none">
                    <p class="mb-4">
                        基礎編で作成したワークフローに品質チェックを追加します。
                    </p>

                    <h3 class="text-xl font-bold mb-3">ワークフローファイルの更新</h3>
                    <p class="mb-4">基礎編で作成した<code>.github/workflows/test.yml</code>を以下のように更新します。</p>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># .github/workflows/test.yml
name: Run Tests

# いつ実行するか
on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

# 実行する処理
jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    # 1. コードをチェックアウト
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. PHPをセットアップ
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: mbstring, xml, ctype, json, bcmath
        coverage: none

    # 3. .envファイルをコピー
    - name: Copy .env
      working-directory: src
      run: php -r "file_exists('.env') || copy('.env.example', '.env');"

    # 4. Composerの依存関係をインストール
    - name: Install dependencies
      working-directory: src
      run: composer install --prefer-dist --no-progress --no-suggest

    # 5. アプリケーションキーを生成
    - name: Generate key
      working-directory: src
      run: php artisan key:generate

    # 6. ディレクトリ権限を設定
    - name: Directory Permissions
      working-directory: src
      run: chmod -R 777 storage bootstrap/cache

    # 7. PHPStanで静的解析（追加）
    - name: Run PHPStan
      working-directory: src
      run: ./vendor/bin/phpstan analyse --memory-limit=512M --error-format=github

    # 8. PHP CS Fixerでコードスタイルチェック（追加）
    - name: Run PHP CS Fixer
      working-directory: src
      run: ./vendor/bin/php-cs-fixer fix --dry-run --diff --format=txt

    # 9. テストを実行
    - name: Run tests
      working-directory: src
      run: php artisan test</code></pre>
                    </div>

                    <div class="bg-green-50 border-l-4 border-green-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">✅ 実行順序</h4>
                        <ol class="list-decimal ml-6 text-sm space-y-1">
                            <li>PHPStan（静的解析）</li>
                            <li>PHP CS Fixer（コードスタイル）</li>
                            <li>PHPUnit（テスト実行）</li>
                        </ol>
                        <p class="text-sm mt-2">いずれかが失敗すると、その時点でワークフローが停止します。</p>
                    </div>
                </div>
            </section>

            <!-- セクション5: GitHubにプッシュして動作確認 -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">🎯 Step 4: GitHubにプッシュして動作確認</h2>

                <div class="prose max-w-none">
                    <p class="text-lg mb-6">
                        これまでに設定したPHPStanとPHP CS Fixerが、GitHub Actions上で正しく動作することを確認します。
                    </p>

                    <h3 class="text-xl font-bold mb-4">1. ローカルで最終チェック</h3>
                    <p class="mb-4">GitHubにプッシュする前に、ローカルで両方のチェックが通ることを確認します。</p>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># PHPStanで型チェック
./vendor/bin/phpstan analyse --memory-limit=512M

# PHP CS Fixerでスタイルチェック
./vendor/bin/php-cs-fixer fix --dry-run --diff</code></pre>
                    </div>

                    <div class="bg-yellow-50 border-l-4 border-yellow-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">⚠️ エラーが出た場合</h4>
                        <ul class="list-disc ml-6 text-sm space-y-1">
                            <li>PHP CS Fixerのエラー → <code>./vendor/bin/php-cs-fixer fix</code> で自動修正</li>
                            <li>PHPStanのエラー → コードを修正してから再チェック</li>
                        </ul>
                    </div>

                    <h3 class="text-xl font-bold mb-4 mt-8">2. .gitignoreの設定</h3>
                    <p class="mb-4">IDE Helperやキャッシュファイルはローカルで生成するものなので、<code>src/.gitignore</code>に追加して除外します。</p>

                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code># src/.gitignore に以下を追加
_ide_helper.php
_ide_helper_models.php
.php-cs-fixer.cache</code></pre>
                    </div>

                    <h3 class="text-xl font-bold mb-4 mt-8">3. GitHubにプッシュ</h3>
                    <div class="code-block-wrapper relative mb-6">
                        <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code>git add .
git commit -m "Add PHPStan and PHP CS Fixer to CI/CD"
git push origin main</code></pre>
                    </div>

                    <h3 class="text-xl font-bold mb-4 mt-8">4. GitHub Actionsで確認</h3>
                    <ol class="list-decimal ml-6 space-y-3 mb-6">
                        <li>GitHubのリポジトリページで「Actions」タブをクリック</li>
                        <li>「Run Tests」ワークフローが実行されていることを確認</li>
                        <li>以下のステップが順番に実行されることを確認：
                            <ul class="list-disc ml-6 mt-2 space-y-1 text-sm">
                                <li>Checkout code</li>
                                <li>Setup PHP</li>
                                <li>Install dependencies</li>
                                <li><strong>Run PHPStan</strong> ← 追加された</li>
                                <li><strong>Run PHP CS Fixer</strong> ← 追加された</li>
                                <li>Run tests</li>
                            </ul>
                        </li>
                    </ol>

                    <div class="bg-green-50 border-l-4 border-green-600 p-4 mb-6">
                        <h4 class="font-bold mb-2">✅ 成功条件</h4>
                        <p class="text-sm">すべてのステップが緑色のチェックマークで完了すれば成功です。特にPHPStanとPHP CS Fixerがエラー0で完了していることを確認しましょう。</p>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-600 p-4">
                        <h4 class="font-bold mb-2">❌ 失敗した場合</h4>
                        <p class="text-sm mb-2">ログを確認して、どのステップで失敗したかを特定します。</p>
                        <ul class="list-disc ml-6 text-sm space-y-1">
                            <li>PHPStanで失敗 → 型エラーを修正してから再プッシュ</li>
                            <li>PHP CS Fixerで失敗 → <code>./vendor/bin/php-cs-fixer fix</code> を実行してから再プッシュ</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- セクション6: Tips -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">💡 Tips & ベストプラクティス</h2>

                <div class="space-y-6">
                    <div class="border-l-4 border-blue-600 pl-4">
                        <h3 class="font-bold text-lg mb-2">1. 段階的な導入</h3>
                        <p class="text-sm">既存プロジェクトにPHPStanを導入する場合、レベル0から始めて徐々に上げていきましょう。</p>
                    </div>

                    <div class="border-l-4 border-blue-600 pl-4">
                        <h3 class="font-bold text-lg mb-2">2. ベースラインの活用</h3>
                        <p class="text-sm">既存プロジェクトにPHPStanを導入する場合、既存のエラーは一旦ベースラインに登録し、新しいコードだけチェックする方法があります。</p>
                        <div class="code-block-wrapper relative mt-2">
                            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-xs"><code># 現在のエラーをベースラインとして記録
./vendor/bin/phpstan analyse --generate-baseline</code></pre>
                        </div>
                    </div>

                    <div class="border-l-4 border-blue-600 pl-4">
                        <h3 class="font-bold text-lg mb-2">3. エディタ統合</h3>
                        <p class="text-sm">VSCodeやPhpStormにPHPStanの拡張機能をインストールすると、コーディング中にリアルタイムでエラーが表示されます。</p>
                    </div>

                    <div class="border-l-4 border-blue-600 pl-4">
                        <h3 class="font-bold text-lg mb-2">4. pre-commitフック</h3>
                        <p class="text-sm mb-2">
                            <strong>pre-commitフックとは：</strong>Gitで<code>git commit</code>を実行した瞬間、コミットが作られる「前」に自動実行されるスクリプトです。
                            チェックに失敗したコードは<strong>そもそもコミットできなくなる</strong>ため、CIでの失敗を事前に防げます。
                        </p>
                        <div class="code-block-wrapper relative mt-2">
                            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-xs"><code>composer require --dev brainmaestro/composer-git-hooks

# composer.jsonに追加
"extra": {
    "hooks": {
        "pre-commit": [
            "vendor/bin/phpstan analyse",
            "vendor/bin/php-cs-fixer fix --dry-run"
        ]
    }
}</code></pre>
                        </div>
                    </div>

                    <div class="border-l-4 border-yellow-600 pl-4">
                        <h3 class="font-bold text-lg mb-2">⚠️ 注意点</h3>
                        <ul class="text-sm space-y-1 list-disc ml-6">
                            <li>PHPStanのレベルを上げすぎると、チーム全体の生産性が下がる可能性があります</li>
                            <li>コードスタイルは統一が重要ですが、完璧を求めすぎないようにしましょう</li>
                            <li>ツールはあくまでサポート役。人間のレビューも重要です</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- スクラムチームでの議論 -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-8">
                <h2 class="text-3xl font-bold mb-6 text-blue-600">👥 チームでの議論：品質基準を決めよう</h2>

                <div class="prose max-w-none">
                    <p class="text-lg mb-6">
                        コード品質ツールを導入する際には、チームで話し合って基準を決めることが大切です。<br>
                        以下のテーマについて、チームで議論してみましょう。
                    </p>

                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <p class="text-blue-800 font-bold mb-2">進め方のヒント</p>
                        <p class="text-sm text-gray-700">
                            まず<strong>「自分の会社（現場）ではどうしているか」</strong>を共有し、<br>
                            その後<strong>「自分ならどう思うか」</strong>を話してみましょう。正解はありません。
                        </p>
                    </div>

                    <!-- 議論1: PHPStanレベル -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-blue-800 mb-3">議論1：PHPStanのチェックレベルをどうする？</h3>
                        <p class="text-gray-700 mb-4">
                            PHPStanにはレベル0〜9があり、数字が大きいほど厳格にチェックします。
                            厳しすぎると開発速度が落ち、緩すぎるとバグを見逃します。
                        </p>
                        <div class="bg-white rounded p-4">
                            <p class="font-bold text-gray-800 mb-2">話し合いのポイント：</p>
                            <ul class="list-disc ml-6 text-gray-700 space-y-1">
                                <li>皆さんの会社では、静的解析ツールを使っていますか？</li>
                                <li>新規プロジェクトと既存プロジェクトで、基準を変えるべき？</li>
                                <li>チームの経験レベルに合わせて段階的に上げていく？</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 議論2: コードスタイルルール -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-green-800 mb-3">議論2：コードスタイルのルールをどこまで統一する？</h3>
                        <p class="text-gray-700 mb-4">
                            インデント、命名規則、改行位置など、スタイルの統一は可読性を高めます。
                            しかし、細かすぎるルールは開発者のストレスになることも。
                        </p>
                        <div class="bg-white rounded p-4">
                            <p class="font-bold text-gray-800 mb-2">話し合いのポイント：</p>
                            <ul class="list-disc ml-6 text-gray-700 space-y-1">
                                <li>皆さんの会社では、コーディング規約はありますか？どう決めましたか？</li>
                                <li>PSR-12のような標準規約を採用する？独自ルールを追加する？</li>
                                <li>自動修正できるものは自動修正に任せる？</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 議論3: DoDへの組み込み -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-purple-800 mb-3">議論3：品質チェックをDone of Definitionに入れる？</h3>
                        <p class="text-gray-700 mb-4">
                            スクラムの「完成の定義（DoD）」に品質チェックを含めると、品質が保証されます。
                            例：「PHPStanエラー0、CS Fixer警告0でないとDoneにならない」
                        </p>
                        <div class="bg-white rounded p-4">
                            <p class="font-bold text-gray-800 mb-2">話し合いのポイント：</p>
                            <ul class="list-disc ml-6 text-gray-700 space-y-1">
                                <li>皆さんのチームのDoDには、どんな品質基準が含まれていますか？</li>
                                <li>品質チェックをCIで強制する（失敗したらマージ不可）にすべき？</li>
                                <li>レビュアーの負担を減らすために、どこまで自動化する？</li>
                            </ul>
                        </div>
                    </div>

                    <!-- AIレビュー演習 -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-yellow-800 mb-3">演習：AIにワークフローをレビューしてもらおう</h3>
                        <p class="text-gray-700 mb-4">
                            作成した<code>.github/workflows/test.yml</code>をAIツール（ChatGPT、Claude等）に見せて、
                            改善点がないか聞いてみましょう。
                        </p>
                        <div class="bg-white rounded p-4">
                            <p class="font-bold text-gray-800 mb-2">プロンプト例：</p>
                            <p class="text-sm text-gray-600 bg-gray-100 p-3 rounded font-mono">
                                「このGitHub Actionsワークフローをレビューして、改善点があれば教えてください。」
                            </p>
                            <p class="text-sm text-gray-600 mt-2">
                                AIからの提案をチームで共有し、採用するかどうかを議論してみましょう。
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- まとめ -->
            <section class="mb-12">
                <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-100 p-8 rounded-lg shadow-lg">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">🎓 応用編のまとめ</h2>
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">学んだこと</h3>
                            <ul class="space-y-2 text-gray-700">
                                <li>✅ PHPStanによる静的解析で型エラーを検出</li>
                                <li>✅ PHP CS Fixerでコーディングスタイルを統一</li>
                                <li>✅ GitHub Actionsに品質チェックを統合</li>
                                <li>✅ 品質ゲートによる自動レビュー</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <!-- 次のステップ -->
        <section class="py-16 bg-white">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">次のステップ</h3>
                        <p class="text-gray-600 mb-8 text-lg">
                            コード品質チェックを学びました。<br>
                            次は<strong>EC2への自動デプロイ</strong>に挑戦します。
                        </p>

                        <a href="cicd-handson-deploy.html" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full inline-block transition text-lg">
                            実践編へ進む →
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- フッター -->
    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white py-12 mt-16">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <p class="text-gray-300 text-sm">
                    &copy; <span id="currentYear"></span> アジャイル ビジネス インスティテュート株式会社
                </p>
            </div>
        </div>
    </footer>

    <script>
        // 現在の年を自動挿入
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>

    <!-- 上部へ戻るボタン -->
    <button id="scrollToTop" class="hidden fixed bottom-8 right-8 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-all duration-300 z-50">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <script src="script.js"></script>
    <script src="code-copy.js"></script>
    <script src="global-menu.js"></script>
    <script src="nav-highlight.js"></script>
    <script src="scroll-to-top.js"></script>
</body>
</html>
